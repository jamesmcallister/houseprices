resources:
- name: source-code
  type: git
  source:
    uri: git@github.com:jamesmcallister/houseprices.git
    branch: concourse
    private_key: {{private_key}}

- name: pipeline-worker
  type: docker-image
  source:
    repository: "concourse-registry:5000/pipeline-worker"
    insecure_registries: ["concourse-registry:5000"]

jobs:
- name: main
  plan:
  - get: source-code
  - put: pipeline-worker
    params:
      build: source-code/docker

- name: hello-world-2
  plan:
  - get: pipeline-worker
  - get: source-code
  - task: say-hello
    image: pipeline-worker
    config:
      platform: linux
      inputs:
        - name: source-code
      run:
        path: bash
        args:
        - -exc
        - |
          . ~/.bashrc
          pushd source-code
            npm install -DE
            npm run test
          popd
